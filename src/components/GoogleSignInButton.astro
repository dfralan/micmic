---
import GoogleButton from "./blocks/GoogleButton.astro";
---

    <GoogleButton id="google" />
    Inici√° con Google
  
  <script>
    import {
      getAuth,
      inMemoryPersistence,
      GoogleAuthProvider,
      signInWithPopup,
    } from "firebase/auth";
    import { app } from "../firebase/client";
  
    const auth = getAuth(app);
    auth.setPersistence(inMemoryPersistence);
  
    const googleSignin = document.querySelector("#google") as HTMLButtonElement;
    googleSignin.addEventListener("click", async () => {
      const provider = new GoogleAuthProvider();
      const userCredential = await signInWithPopup(auth, provider);
      const idToken = await userCredential.user.getIdToken();
      const res = await fetch("/api/auth/signin", {
        headers: {
          Authorization: `Bearer ${idToken}`,
        },
      });
  
      if (res.redirected) {
        window.location.assign(res.url);
      }
    });
  </script>