---
import GoogleIcon from "../assets/icons/GoogleIcon.astro";
---

    <button id="google" class="bg-white border border-gray-300 text-sm rounded-xl hover:shadow flex flex-row gap-2 items-center justify-center p-2">
      <GoogleIcon />
      Inici√° con Google
    </button>
  
  <script>
    import {
      getAuth,
      inMemoryPersistence,
      GoogleAuthProvider,
      signInWithPopup,
    } from "firebase/auth";
    import { app } from "../firebase/client";
  
    const auth = getAuth(app);
    auth.setPersistence(inMemoryPersistence);
  
    const googleSignin = document.querySelector("#google") as HTMLButtonElement;
    googleSignin.addEventListener("click", async () => {
      const provider = new GoogleAuthProvider();
      const userCredential = await signInWithPopup(auth, provider);
      const idToken = await userCredential.user.getIdToken();
      const res = await fetch("/api/auth/signin", {
        headers: {
          Authorization: `Bearer ${idToken}`,
        },
      });
  
      if (res.redirected) {
        window.location.assign(res.url);
      }
    });
  </script>